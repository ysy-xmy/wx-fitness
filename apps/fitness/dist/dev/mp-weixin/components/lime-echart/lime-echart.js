"use strict";const e=require("../../common/vendor.js"),h=require("../../api/body/index.js");require("../../utils/request.js");Array||e.resolveComponent("l-echart")();const Z=()=>"../l-echart/l-echart.js";Math||Z();const ee={__name:"lime-echart",props:{beginTime:String,endTime:String},setup(k){const T=k,y=e.ref("weight"),v=e.ref("month"),p=e.ref("bust");e.onMounted(()=>{e.index.$on("changeTime",()=>{setTimeout(()=>{D(y.value)},1)}),e.index.$on("changeType",t=>{b.value=t}),e.index.$on("change",t=>{console.log(t,"123"),y.value=t,D(t)}),D("weight")});const B=t=>{v.value=t.detail.name,D(y.value)},C=t=>{p.value=t.detail.name,D(y.value)},D=t=>{e.index.showLoading();let a="";t=="three"?a=p.value:a=t;const o={Type:a,Count:1e3,StartTime:`${T.beginTime} 00:00:00`,EndTime:`${T.endTime} 23:59:59`};h.getBodydata(o).then(s=>{S.value=[],A.value=[],W(),v.value=="day"||y.value=="three"?H(s.data.data,T.beginTime,T.endTime).then(()=>{x(),e.index.hideLoading()}):v.value=="week"&&y.value!="three"?K(s.data.data,T.beginTime,T.endTime).then(()=>{x(),e.index.hideLoading()}):v.value=="month"&&y.value!="three"&&R(s.data.data,T.beginTime,T.endTime).then(()=>{x(),e.index.hideLoading()})})},S=e.ref([]),A=e.ref([]),P=e.ref(!1),$=e.ref([]),I=e.ref([]),F=e.ref(null),x=()=>{F.value.init(e.core,t=>{const a={tooltip:{trigger:"axis",formatter:o=>`${o[0].axisValue}: ${o[0].data}`},xAxis:{type:"category",data:S.value},yAxis:{type:"value"},series:[{data:A.value,type:"line",smooth:!0,emphasis:{focus:"series"},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(58,177,255,0.5)"},{offset:1,color:"rgba(58,177,255,0.1)"}]}},lineStyle:{color:"#3AB1FF"},itemStyle:{color:"#3AB1FF"}}]};console.log(a),t.setOption(a),t.on("showTip",o=>{P.value=!0,I.value=[o],o.event?$.value=[o.event.offsetX||0,o.event.offsetY||0]:$.value=[0,0]}),t.on("hideTip",()=>{setTimeout(()=>{P.value=!1},300)})})},b=e.ref(0),W=async()=>{var a,o,s,n,r,u,i,l,f,Y,c,d;let t={};if(y.value=="three"){const m={Type:"BUST",Count:1,StartTime:"1999-01-01 00:00:00",EndTime:`${e.dayjs().format("YYYY-MM-DD")} 23:59:59`,OrderBy:"ASC"},_={Type:"BUST",Count:1,StartTime:"1999-01-01 00:00:00",EndTime:`${e.dayjs().format("YYYY-MM-DD")} 23:59:59`,OrderBy:"DESC"},E={Type:"WAIST",Count:1,StartTime:"1999-01-01 00:00:00",EndTime:`${e.dayjs().format("YYYY-MM-DD")} 23:59:59`,OrderBy:"ASC"},M={Type:"WAIST",Count:1,StartTime:"1999-01-01 00:00:00",EndTime:`${e.dayjs().format("YYYY-MM-DD")} 23:59:59`,OrderBy:"DESC"},j={Type:"HIP",Count:1,StartTime:"1999-01-01 00:00:00",EndTime:`${e.dayjs().format("YYYY-MM-DD")} 23:59:59`,OrderBy:"ASC"},w={Type:"HIP",Count:1,StartTime:"1999-01-01 00:00:00",EndTime:`${e.dayjs().format("YYYY-MM-DD")} 23:59:59`,OrderBy:"DESC"},J=await Promise.all([h.getBodydata(m),h.getBodydata(_),h.getBodydata(E),h.getBodydata(M),h.getBodydata(j),h.getBodydata(w)]),[V,X,z,G,N,Q]=J;t={old:{BUST:((a=X.data.data[0])==null?void 0:a.Value)||0,WAIST:((o=G.data.data[0])==null?void 0:o.Value)||0,HIP:((s=Q.data.data[0])==null?void 0:s.Value)||0,time:e.dayjs((n=V.data.data[0])==null?void 0:n.CreatedAt).format("YYYY-MM-DD")},new:{BUST:((r=V.data.data[0])==null?void 0:r.Value)||0,WAIST:((u=z.data.data[0])==null?void 0:u.Value)||0,HIP:((i=N.data.data[0])==null?void 0:i.Value)||0,time:e.dayjs((l=V.data.data[0])==null?void 0:l.CreatedAt).format("YYYY-MM-DD")}}}else{const m=y.value;console.log();const _={Type:m,Count:1,StartTime:"1999-01-01 00:00:00",EndTime:`${e.dayjs().format("YYYY-MM-DD")} 23:59:59`,OrderBy:"ASC"},E={Type:m,Count:1,StartTime:"1999-01-01 00:00:00",EndTime:`${e.dayjs().format("YYYY-MM-DD")} 23:59:59`,OrderBy:"DESC"},M=await Promise.all([h.getBodydata(_),h.getBodydata(E)]),[j,w]=M;console.log(M,"res","123"),t={oldVal:((f=j.data.data[0])==null?void 0:f.Value)||0,oldTime:e.dayjs((Y=j.data.data[0])==null?void 0:Y.CreatedAt).format("YYYY-MM-DD"),newVal:((c=w.data.data[0])==null?void 0:c.Value)||0,newTime:e.dayjs((d=w.data.data[0])==null?void 0:d.CreatedAt).format("YYYY-MM-DD")},console.log("发送"+m),(m=="weight"||m==="height")&&e.index.$emit("changeBody",{Type:m,val:t.newVal})}e.index.$emit("changeBotData",t),console.log(t)},g=e.ref(0),O=async t=>{var r;const o={Type:y.value==="three"?p.value:y.value,Count:t+1,StartTime:"1999-01-01 00:00:00",EndTime:`${T.endTime} 23:59:59`},n=(await h.getBodydata(o)).data.data;g.value=n.length===t?0:((r=n[0])==null?void 0:r.Value)||0},L=t=>{const a={},o={};t.forEach(s=>{const n=e.dayjs(s.CreatedAt).startOf("week").format("YYYY-MM-DD"),r=e.dayjs(s.CreatedAt).unix();(!a[n]||a[n].time<r)&&(a[n]={value:s.Value,time:r})});for(let s of Object.keys(a))o[s]=a[s].value;return o},H=async(t,a,o)=>new Promise(async(s,n)=>{const r=t||[],u={};let i=e.dayjs(a);const l=e.dayjs(o);await Promise.all([O(t.length),(async()=>{for(;i.isBefore(l)||i.isSame(l);){const c=i.startOf("week").format("YYYY-MM-DD");u[c]=0;const d=i.add(1,"week");if(d.isAfter(l)){u[l.format("YYYY-MM-DD")]=0;break}i=d}})()]);const f=L(r),Y=Object.keys(u);S.value=Y,A.value=Y.map(c=>{const d=f[c]||g.value;return f[c]&&(g.value=d),d}),s(!0)}),U=t=>{const a={},o={};t.forEach(s=>{const n=e.dayjs(s.CreatedAt).startOf("month").format("YYYY-MM"),r=e.dayjs(s.CreatedAt).unix();(!a[n]||a[n].time<r)&&(a[n]={value:s.Value,time:r})});for(let s of Object.keys(a))o[s]=a[s].value;return o},K=async(t,a,o)=>new Promise(async(s,n)=>{const r=t||[],u={};let i=e.dayjs(a);const l=e.dayjs(o);await Promise.all([O(t.length),(async()=>{for(;i.isBefore(l)||i.isSame(l);){const c=i.startOf("month").format("YYYY-MM");u[c]=0;const d=i.add(1,"month");if(d.isAfter(l)){const m=l.format("YYYY-MM");m!==c&&(u[m]=0);break}i=d}})()]);const f=U(r),Y=Object.keys(u);S.value=Y,A.value=Y.map(c=>{const d=f[c]||g.value;return f[c]&&(g.value=d),d}),s(!0)}),q=t=>{const a={},o={};t.forEach(s=>{const n=e.dayjs(s.CreatedAt).startOf("year").format("YYYY"),r=e.dayjs(s.CreatedAt).unix();(!a[n]||a[n].time<r)&&(a[n]={value:s.Value,time:r})});for(let s of Object.keys(a))o[s]=a[s].value;return o},R=async(t,a,o)=>new Promise(async(s,n)=>{const r=t||[],u={};let i=e.dayjs(a);const l=e.dayjs(o);await Promise.all([O(t.length),(async()=>{for(;i.isBefore(l)||i.isSame(l);){const c=i.startOf("year").format("YYYY");u[c]=0;const d=i.add(1,"year");if(d.isAfter(l)){const m=l.format("YYYY");m!==c&&(u[m]=0);break}i=d}})()]);const f=q(r),Y=Object.keys(u);S.value=Y,A.value=Y.map(c=>{const d=f[c]||g.value;return f[c]&&(g.value=d),d}),s(!0)});return(t,a)=>e.e({a:b.value!=1},b.value!=1?{b:e.n(v.value=="month"?"text-_hFF5E3A_ cur":""),c:e.o(()=>B({detail:{name:"month"}})),d:e.n(v.value=="week"?"text-_hFF5E3A_ cur":""),e:e.o(()=>B({detail:{name:"week"}})),f:e.n(v.value=="day"?"text-_hFF5E3A_ cur":""),g:e.o(()=>B({detail:{name:"day"}}))}:{h:e.n(p.value=="bust"?"text-_hFF5E3A_ cur":""),i:e.o(()=>C({detail:{name:"bust"}})),j:e.n(p.value=="waist"?"text-_hFF5E3A_ cur":""),k:e.o(()=>C({detail:{name:"waist"}})),l:e.n(p.value=="hip"?"text-_hFF5E3A_ cur":""),m:e.o(()=>C({detail:{name:"hip"}}))},{n:e.sr(F,"d43d48e2-0",{k:"chart"}),o:e.o(x)})}},te=e._export_sfc(ee,[["__scopeId","data-v-d43d48e2"],["__file","J:/fItness/wx-fitness/apps/fitness/src/components/lime-echart/lime-echart.vue"]]);wx.createComponent(te);
