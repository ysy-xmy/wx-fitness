"use strict";const e=require("../../common/vendor.js"),b=require("../../state/modules/actions.js"),we=require("../../state/modules/auth.js"),A=require("../../api/action/action.js");require("../../state/modules/mes.js");require("../../api/notify/index.js");require("../../utils/request.js");if(!Array){const W=e.resolveComponent("uni-calendar"),y=e.resolveComponent("van-icon"),E=e.resolveComponent("van-radio"),p=e.resolveComponent("van-cell"),$=e.resolveComponent("van-cell-group"),P=e.resolveComponent("van-radio-group"),D=e.resolveComponent("van-field"),m=e.resolveComponent("van-dialog");(W+y+E+p+$+P+D+m)()}const Ie=()=>"../../uni_modules/uni-calendar/components/uni-calendar/uni-calendar.js";Math||Ie();const _e=e.defineComponent({__name:"index",setup(W){const y=e.H(),E=we.useAuthStore(),p=e.ref([]),$=e.ref("2023-01-01"),P=e.ref("2054-12-31"),D=e.ref(!1),m=e.ref(new Date().toISOString().split("T")[0]),w=e.ref(415),G=e.ref(!1),j=e.ref(0),F=e.ref(150),B=e.ref(null),h=e.ref(""),d=e.ref([]),u=b.useActionsStore(),I=e.ref(""),ne=e.ref(1/0),i=e.ref([]);e.ref([{weight:20,time:20},{weight:20,time:20},{weight:20,time:20}]);const ae=o=>{I.value=o.detail},H=(o,a)=>{console.log(a);let t={ID:a.ID,ActionGroupTitle:a.title,ContentType:a.type,OrderNum:0};A.changeActionGroupDetail(t).then(l=>{l.data.code===200||e.index.showToast({title:"保存失败",icon:"error"})})},O=e.E();e.onShow(()=>{M(h.value)});const f=e.computed(()=>E.user.RoleName||""),R=o=>{console.log(o,"item");let a={type:o.type,name:o.title};u.setChooseActions(a),y.push({name:"actionArrange"})},L=o=>{console.log(o,123),y.push({name:"actionDetail",params:{itemid:String(o.ExerciseActionID)}})};function J(o,a=0){o||(o=new Date),typeof o!="object"&&(o=o.replace(/-/g,"/"));const t=new Date(o);t.setDate(t.getDate()+a);const l=t.getFullYear(),c=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,n=t.getDate()<10?"0"+t.getDate():t.getDate();return{fullDate:l+"-"+c+"-"+n,year:l,month:c,date:n,day:t.getDay()}}const k=e.ref(!1),_=e.ref(""),K=o=>{_.value=o},le=()=>{A.getActionDate({id:b.useActionsStore().getClassID,type:b.useActionsStore().getFindActionData.Type}).then(o=>{console.log(o,"res"),o.data.code===200&&o.data.data&&(p.value=o.data.data.map(a=>({date:e.dayjs(a).format("YYYY-MM-DD")})),e.nextTick$1(()=>{D.value=!1,e.nextTick$1(()=>{D.value=!0})}))})},x=()=>{I.value="",_.value="",k.value=!1},ce=()=>{if(console.log(_.value,"radioType"),console.log(I.value,"addClassName"),!_.value){e.index.showToast({title:"请选择课程类型",icon:"none"});return}if(!I.value){e.index.showToast({title:"请输入动作组名称",icon:"none"});return}let o={type:_.value,name:I.value};u.setChooseActions(o),x(),y.push({name:"actionArrange"})},Q=(o,a)=>{const t=d.value.find(c=>c.title===o.title||c.title===o.type),l=t==null?void 0:t.planActions.find(c=>c.ID===a.ID);l&&l.PlanActionDetail.push(o.type=="weight"?{Weight:"",GroupNum:""}:{Second:""})},se=()=>{k.value=!0};e.watch(()=>h.value,o=>{o&&(console.log(o,"newVal",p.value,p.value.find(a=>a.date===h.value)),M(o))},{immediate:!0,deep:!0});const M=o=>{const a={id:b.useActionsStore().getClassID,date:e.dayjs(o).format("YYYY-MM-DD"),type:b.useActionsStore().getFindActionData.Type};A.getActionByDate(a).then(t=>{d.value=[],console.log(t.data,"res"),t.data.code===200&&t.data.data&&(t.data.data.forEach((l,c)=>{d.value.push({ID:l.ID,planActions:l.PlanActions,title:l.ActionGroupTitle||`动作${c+1}`,type:l.ContentType,isEditing:!1,showGroup:!1})}),console.log(d.value,"planListType"))}).catch(t=>{console.log(t,"err"),e.index.showToast({title:"获取动作失败",icon:"none"})})};e.onMounted(()=>{console.log(u.getFindActionData,"actionsStore.getFindActionData"),O.query&&(ne.value=O.query.id),e.nextTick$1(()=>{D.value=!0,m.value=V(u.getTime),h.value=V(u.getTime),$.value=J(new Date,-60).fullDate,P.value=J(new Date,30).fullDate,le(),console.log(p.value,"selected")})});const U=()=>{e.nextTick$1(()=>{var a;const o=(a=B.value)==null?void 0:a.querySelector(".uni-calendar-item--selected");if(o){const t=o.offsetTop;B.value.scrollTop=t}})},ue=o=>{console.log("选择的日期是:",o),h.value=o.fulldate,U()},re=o=>{console.log("切换月份:",o)},ie=()=>{w.value=w.value===150?415:150,w.value===150&&U()},fe=o=>{G.value=!0,j.value=o.touches[0].clientY,F.value=w.value},ve=o=>{if(!G.value)return;const a=o.touches[0].clientY-j.value,t=F.value+a;w.value=Math.min(Math.max(t,150),415)},de=o=>{M(h.value),o.isEditing=!1},ge=()=>{G.value=!1},X=o=>{o.isEditing?de(o):o.isEditing=!o.isEditing},T=e.ref(!1),C=e.ref(null),Z=(o,a,t)=>{C.value={item:o,it:a,index:t},console.log(C.value,"currentRemoveGroupInfo"),T.value=!0},he=()=>{if(!C.value)return;const{item:o,it:a,index:t}=C.value,l=d.value.find(n=>n.title===o.title||n.title===o.type),c=l==null?void 0:l.planActions.find(n=>n.ID===a.ID);c&&c.PlanActionDetail[t].ID?A.deleteDetailFromGroup(c.PlanActionDetail[t].ID).then(n=>{console.log(n,"res"),n.data.code===200?(e.index.showToast({title:"删除成功",icon:"success"}),c.PlanActionDetail.splice(t,1)):e.index.showToast({title:n.data.msg,icon:"error"}),T.value=!1}):c&&(c.PlanActionDetail.splice(t,1),T.value=!1)},pe=o=>{let a=o[0]&&o[0].Weight||0;return o.forEach(t=>{Number(t.Weight)>a&&(a=Number(t.Weight))}),a},De=o=>o.reduce((a,t)=>a+Number(t.Second),0),z=(o,a,t,l)=>{console.log(o,a,t,l,"item, it, index");const c={Weight:Number(a.PlanActionDetail[t].Weight||0),GroupNum:Number(a.PlanActionDetail[t].GroupNum||0),Second:Number(a.PlanActionDetail[t].Second||0)};if(a.PlanActionDetail[t].ID)c.ID=a.PlanActionDetail[t].ID,A.updateDetailFromGroup(c).then(n=>{console.log(n,"res"),n.data.code===200?e.index.showToast({title:"保存成功",icon:"success"}):e.index.showToast({title:n.data.msg,icon:"error"})});else{const n={...c,PlanActionId:a.ID};A.addDetailToGroup(n).then(S=>{console.log(S,"res"),S.data.code===200&&(a.PlanActionDetail[t].ID=S.data.data.ID,console.log(d.value,"planListType.value"))})}},V=o=>new Date(o.replace(" ","T")).toISOString().split("T")[0],q=e.ref(null),N=e.ref(!1),ee=(o,a)=>{q.value={item:o,it:a},N.value=!0},Ae=()=>{if(!q.value)return;const{item:o,it:a}=q.value;A.deleteActionFromGroup([a.ID]).then(t=>{if(t.data.code==200){const l=d.value.findIndex(c=>c.title===o.title);l!==-1&&(d.value[l].planActions=d.value[l].planActions.filter(c=>c.ActionName!==a.ActionName)),e.index.showToast({title:"删除成功",icon:"success"})}else e.index.showToast({title:"删除失败",icon:"none"});N.value=!1}).catch(t=>{console.log(t,"err"),e.index.showToast({title:"删除失败",icon:"none"}),N.value=!1})},me=e.ref(null),te=o=>{me.value=o},oe=o=>{};return(o,a)=>e.e({a:e.o(ue),b:e.o(re),c:e.p({selected:p.value,showMonth:D.value,insert:!0,range:!1,clearDate:!1,showToday:!1,date:m.value,weeksCount:D.value?6:1}),d:w.value+"px",e:e.o(fe),f:e.o(ve),g:e.o(ge),h:e.o(ie),i:e.f(d.value,(t,l,c)=>e.e({a:t.type==="weight"&&t.planActions.length>0},t.type==="weight"&&t.planActions.length>0?e.e({b:!t.isEditing},t.isEditing?{d:e.o(n=>H(n,t),l),e:t.title,f:e.o(n=>t.title=n.detail.value,l)}:{c:e.t(t.title)},{g:e.o(n=>X(t),l),h:"3ecb826f-1-"+c,i:e.p({name:"edit",size:"20",color:"white"}),j:e.unref(f)==="coach"||e.unref(u).getCoachID===0},e.unref(f)==="coach"||e.unref(u).getCoachID===0?{k:e.o(n=>R(t),l),l:"3ecb826f-2-"+c,m:e.p({name:"plus",size:"20",color:"white"})}:{},{n:e.f(t.planActions,(n,S,g)=>e.e(t.isEditing&&(e.unref(f)==="coach"||e.unref(u).getCoachID===0)?{a:"3ecb826f-3-"+c+"-"+g,b:e.p({name:"minus",size:"15",color:"white"}),c:e.o(r=>ee(t,n),n.ActionName)}:{},{d:e.t(n.ActionName),e:e.o(r=>L(n),n.ActionName),f:e.t(pe(n.PlanActionDetail)),g:e.t(n.PlanActionDetail.length),h:e.o(r=>i.value.includes(n.ID)?i.value.splice(i.value.indexOf(n.ID),1):i.value.push(n.ID),n.ActionName),i:"3ecb826f-4-"+c+"-"+g,j:e.p({name:i.value.includes(n.ID)?"arrow-up":"arrow-down",size:"20",color:"black"})},t.isEditing&&(e.unref(f)==="coach"||e.unref(u).getCoachID===0)?{k:"3ecb826f-5-"+c+"-"+g,l:e.p({name:"plus",size:"15",color:"white"}),m:e.o(r=>Q(t,n),n.ActionName)}:{},{n:i.value.includes(n.ID)},i.value.includes(n.ID)?{o:e.f(n.PlanActionDetail,(r,s,Y)=>e.e(t.isEditing?{d:e.t(s+1),e:e.o(v=>z(t,n,s,v),s),f:r.Weight,g:e.o(v=>r.Weight=v.detail.value,s),h:e.o(v=>z(t,n,s,v),s),i:r.GroupNum,j:e.o(v=>r.GroupNum=v.detail.value,s),k:e.o(v=>Z(t,n,s),s),l:"3ecb826f-6-"+c+"-"+g+"-"+Y,m:e.p({name:"minus",size:"15",color:"red"})}:{a:e.t(s+1),b:e.t(r.Weight||0),c:e.t(r.GroupNum||0)},{n:s})),p:!t.isEditing}:{},{q:n.ActionName})),o:t.isEditing&&(e.unref(f)==="coach"||e.unref(u).getCoachID===0),p:t.isEditing&&(e.unref(f)==="coach"||e.unref(u).getCoachID===0),q:e.o(n=>te(l),l),r:e.o(n=>oe(),l)}):{},{s:t.type==="stretch"&&t.planActions.length>0},t.type==="stretch"&&t.planActions.length>0?e.e({t:!t.isEditing},t.isEditing?{w:e.o(n=>H(n,t),l),x:t.title,y:e.o(n=>t.title=n.detail.value,l)}:{v:e.t(t.title)},{z:e.o(n=>X(t),l),A:"3ecb826f-7-"+c,B:e.p({name:"edit",size:"20",color:"white"}),C:e.unref(f)==="coach"||e.unref(u).getCoachID===0},e.unref(f)==="coach"||e.unref(u).getCoachID===0?{D:e.o(n=>R(t),l),E:"3ecb826f-8-"+c,F:e.p({name:"plus",size:"20",color:"white"})}:{},{G:e.f(t.planActions,(n,S,g)=>e.e(t.isEditing&&(e.unref(f)==="coach"||e.unref(u).getCoachID===0)?{a:"3ecb826f-9-"+c+"-"+g,b:e.p({name:"minus",size:"15",color:"white"}),c:e.o(r=>ee(t,n),n.ActionName)}:{},{d:e.t(n.ActionName),e:e.o(r=>L(n),n.ActionName),f:e.t(De(n.PlanActionDetail)),g:e.t(n.PlanActionDetail.length),h:e.o(r=>i.value.includes(n.ID)?i.value.splice(i.value.indexOf(n.ID),1):i.value.push(n.ID),n.ActionName),i:"3ecb826f-10-"+c+"-"+g,j:e.p({name:i.value.includes(n.ID)?"arrow-up":"arrow-down",size:"20",color:"black"})},t.isEditing&&(e.unref(f)==="coach"||e.unref(u).getCoachID===0)?{k:"3ecb826f-11-"+c+"-"+g,l:e.p({name:"plus",size:"15",color:"white"}),m:e.o(r=>Q(t,n),n.ActionName)}:{},{n:i.value.includes(n.ID)},i.value.includes(n.ID)?{o:e.f(n.PlanActionDetail,(r,s,Y)=>e.e(t.isEditing?{c:e.t(s+1),d:e.o(v=>z(t,n,s,v),s),e:r.Second,f:e.o(v=>r.Second=v.detail.value,s),g:e.o(v=>Z(t,n,s),s),h:"3ecb826f-12-"+c+"-"+g+"-"+Y,i:e.p({name:"minus",size:"15",color:"red"})}:{a:e.t(s+1),b:e.t(r.Second||0)},{j:s})),p:!t.isEditing}:{},{q:n.ActionName})),H:t.isEditing&&(e.unref(f)==="coach"||e.unref(u).getCoachID===0),I:t.isEditing&&(e.unref(f)==="coach"||e.unref(u).getCoachID===0),J:t.planActions.length===0},t.planActions.length===0?{}:{},{K:e.o(n=>te(l),l),L:e.o(n=>oe(),l)}):{},{M:l})),j:d.value.length===0},d.value.length===0?{}:{},{k:(e.unref(f)==="coach"||e.unref(u).getCoachID===0)&&h.value==m.value},(e.unref(f)==="coach"||e.unref(u).getCoachID===0)&&h.value==m.value?{l:e.p({name:"plus",size:"24",color:"#ffffff"}),m:e.o(se)}:{},{n:e.p({name:"stretch"}),o:e.o(()=>K("stretch")),p:e.p({title:"放松训练",valueClass:"value-class",clickable:!0}),q:e.p({name:"weight"}),r:e.o(()=>K("weight")),s:e.p({title:"力量训练",valueClass:"value-class",clickable:!0}),t:e.p({value:_.value}),v:e.o(ae),w:e.p({value:I.value,placeholder:"请输入动作组名称",border:"true"}),x:e.o(ce),y:e.o(x),z:e.p({useSlot:!0,title:"课程信息",show:k.value,showCancelButton:!0}),A:e.o(Ae),B:e.o(t=>N.value=!1),C:e.p({useSlot:!0,title:"提示",show:N.value,showCancelButton:!1,showConfirmButton:!1}),D:e.t(C.value?C.value.index+1:""),E:e.o(he),F:e.o(t=>T.value=!1),G:e.p({useSlot:!0,title:"提示",show:T.value,showCancelButton:!1,showConfirmButton:!1})})}}),Ce=e._export_sfc(_e,[["__scopeId","data-v-3ecb826f"],["__file","J:/fItness/wx-fitness/apps/fitness/src/subpackages/calender/index.vue"]]);wx.createPage(Ce);
