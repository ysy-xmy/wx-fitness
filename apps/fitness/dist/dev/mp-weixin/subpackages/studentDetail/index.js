"use strict";const e=require("../../common/vendor.js"),F=require("../../api/course/index.js"),W=require("../../api/coach/index.js"),K=require("../../state/app.js"),S=require("../../api/courses/courses.js"),Q=require("../../state/modules/actions.js");require("../../utils/request.js");if(!Array){const L=e.resolveComponent("van-tag"),r=e.resolveComponent("van-icon"),h=e.resolveComponent("van-button"),s=e.resolveComponent("van-tab"),v=e.resolveComponent("van-tabs"),p=e.resolveComponent("van-collapse-item"),b=e.resolveComponent("van-collapse"),m=e.resolveComponent("van-radio"),g=e.resolveComponent("van-cell"),f=e.resolveComponent("van-cell-group"),D=e.resolveComponent("van-radio-group"),_=e.resolveComponent("van-field"),c=e.resolveComponent("van-dialog"),w=e.resolveComponent("van-datetime-picker");(L+r+h+s+v+p+b+m+g+f+D+_+c+w)()}Math||X();const X=()=>"../../components/plan-card/index.js",Z=e.defineComponent({__name:"index",setup(L){K.useAppStore();const r=Q.useActionsStore(),h=e.H(),s=e.ref(),v=e.ref(),p=e.ref(""),b=e.ref(r.getClassname||"私教课"),m=e.ref(""),g=e.ref(!1);e.ref();const f=e.ref(!1),D=e.ref(!1),_=e.ref([]),c=e.ref(new Date().getTime()),w=e.dayjs().format("YYYY-MM-DD"),$=e.dayjs().add(1,"year").format("YYYY-MM-DD"),n=e.ref([]),C=["rgb(144,199,97)","rgb(226,198,29)","rgb(217,9,84)"],x=e.ref("outline");e.ref(["私教课"]);const T=e.ref(!1),q=a=>{console.log(a,"changeTab"),x.value=a.detail.name},E=a=>{console.log(a,"deletePlan"),Object.keys(i.value).forEach(t=>{i.value[t]=i.value[t].filter(o=>o.ID!==a.ID)})},U=e.computed(()=>i.value[x.value]),y=e.computed(()=>r.getRemark),j=a=>{console.log(a,"onInput"),c.value=a.detail},O=()=>{const a=JSON.stringify(s.value.BodyCheckImg);h.push({path:`/subpackages/bodyFormDetail/index?img=${a}&&name=${s.value.Username}`})},z=()=>{n.value.push({content:m.value,color:C[Math.floor(Math.random()*C.length)]}),P("add")},P=a=>{let t={UserCourseID:Number(u.value.courseId),Labels:n.value.map(o=>o.content)};S.sendCourseStudentTag(t).then(o=>{console.log(o,"res"),o.data.code===200?(e.index.showToast({title:a=="add"?"添加成功":"删除成功"}),g.value=!1):e.index.showToast({title:a=="add"?"添加失败":"删除失败",icon:"none"})}).catch(o=>{e.index.showToast({title:a=="add"?"添加失败":"删除失败",icon:"none"})})},B=a=>{_.value=a.detail},G=()=>{f.value=!0},Y=e.computed(()=>e.dayjs(c.value).format("YYYY-MM-DD")),H=a=>{v.value=a.detail},i=e.ref({online:[],outline:[],finish:[]}),M=a=>{console.log(a,"deleteTag"),n.value=n.value.filter(t=>t!==a),P("delete")},N=()=>{f.value=!1,p.value="OUTLINE",v.value="",c.value=new Date().getTime()},k=a=>{p.value=a},J=a=>{console.log(a,"addTagVal"),m.value=a.detail},V=()=>{var t;if(!p.value){e.index.showToast({title:"请选择课程类型",icon:"error"});return}if(!((t=v.value)!=null&&t.trim())){e.index.showToast({title:"请输入课程名称",icon:"error"});return}if(!c.value){e.index.showToast({title:"请选择日期",icon:"error"});return}const a={UserID:Number(u.value.studentId),UserCourseID:Number(u.value.courseId),Type:p.value,PlanTitle:v.value.trim(),PlanTime:e.dayjs(c.value).format("YYYY-MM-DD")};F.postPlan(a).then(o=>{o.data.code===200?(e.index.showToast({title:"添加成功！"}),N(),setTimeout(()=>{I()},2500)):e.index.showToast({title:o.data.msg||"添加失败！",icon:"error"})}).catch(o=>{var d,l;e.index.showToast({title:((l=(d=o.response)==null?void 0:d.data)==null?void 0:l.msg)||"网络请求失败！",icon:"error"})})},u=e.ref(),I=async()=>{if(u.value){i.value={online:[],outline:[],finish:[]},e.index.showLoading({title:"加载中...",mask:!0}),D.value=u.value.CoachPunchInAuth;const a=await W.getstudentInfobyId(u.value.studentId);s.value=a.data.data;const t=await F.getCoursePlan(u.value.courseId);if(console.log(t,"response获取课程成功"),t.data.data===null||!t.data.data)return e.index.hideLoading();t.data.data.forEach(o=>{let d={PlanTitle:o.PlanTitle||"私教课",PlanTime:o.PlanTime,Complete:o.Complete?1:0,ID:o.ID,Type:o.Type,actionGroups:(o.ActionGroups||[]).map((l,A)=>({title:l.ActionGroupTitle||`动作${A+1}`,date:"",status:l.Complete,List:l.PlanActions,type:l.ContentType}))};r.getChooseActionId!=-1/0&&r.getChooseActionId==o.ID&&(r.setPlanList(d),console.log(r.setPlanList,"actionsStore.getChooseActions")),o.Complete?i.value.finish.push(d):i.value[o.Type.toLowerCase()].push(d)}),console.log(i.value,"plansList"),e.index.hideLoading()}},R=async()=>{const a=await S.getCourseStudentTag(u.value.courseId);console.log(a,"res"),n.value=[],a.data.data.Labels.forEach(t=>{t&&n.value.push({content:t,color:C[Math.floor(Math.random()*C.length)]})})};return e.onMounted(()=>{u.value=h.route.value.query,I(),R(),e.index.$on("getNew",()=>{I()}),e.index.$on("reload",()=>{console.log("重新获取"),I(),console.log(r.getChooseActionId,"plansList")})}),(a,t)=>e.e({a:e.f(n.value.slice(0,6),(o,d,l)=>({a:e.t(o.content),b:o,c:e.o(A=>M(o),o),d:"0865f6d7-0-"+l,e:e.p({round:!0,size:"large",color:o.color,closeable:"true"})})),b:n.value.length<6},n.value.length<6?{c:e.p({name:"plus",color:"black",size:"12"}),d:e.o(o=>g.value=!0),e:e.p({color:"#F0FFFF"})}:{},{f:n.value.length>=6},n.value.length>=6?e.e({g:e.f(n.value.slice(6,12),(o,d,l)=>({a:e.t(o.content),b:o,c:e.o(A=>M(o),o),d:"0865f6d7-3-"+l,e:e.p({round:!0,color:o.color,size:"large",closeable:"true"})})),h:n.value.length<12},n.value.length<12?{i:e.p({name:"plus",color:"black",size:"12"}),j:e.o(o=>g.value=!0),k:e.p({color:"#F0FFFF"})}:{}):{},{l:s.value.Avatar||"https://zhanjiang-fitness.oss-cn-guangzhou.aliyuncs.com/20250105/1736063470137.png",m:e.t(s.value.Username||"默认用户"),n:e.unref(y)},e.unref(y)?{o:e.t(e.unref(y))}:{},{p:e.t(s.value.Age||"暂未填写"),q:e.t(s.value.Weight),r:e.t(s.value.Height),s:e.o(O),t:e.p({title:"线下计划",name:"outline"}),v:e.p({title:"线上任务",name:"online"}),w:e.p({title:"已完成",name:"finish"}),x:e.o(q),y:e.p({active:x.value}),z:e.t(b.value),A:e.o(E),B:e.p({isHideHeader:!0,status:1,actionGroups:e.unref(U)}),C:e.p({name:"1"}),D:e.o(B),E:e.p({value:_.value}),F:e.o(G),G:e.p({name:"ONLINE"}),H:e.o(()=>k("ONLINE")),I:e.p({title:"在线任务",valueClass:"value-class",clickable:!0}),J:e.p({name:"OUTLINE"}),K:e.o(()=>k("OUTLINE")),L:e.p({title:"线下任务",valueClass:"value-class",clickable:!0}),M:e.p({value:p.value}),N:e.o(H),O:e.p({value:v.value,placeholder:"请输入课程名",border:"true"}),P:e.t(e.unref(Y)),Q:e.unref(Y),R:e.o(o=>c.value=o.detail.value),S:e.o(V),T:e.o(N),U:e.p({useSlot:!0,title:"课程信息",show:f.value,showCancelButton:!0}),V:T.value},T.value?{W:e.o(j),X:e.o(o=>T.value=!1),Y:e.o(o=>T.value=!1),Z:e.p({type:"date",value:c.value,minDate:e.unref(w),maxDate:e.unref($)})}:{},{aa:e.o(J),ab:e.p({value:m.value,placeholder:"输入标签",maxlength:"7"}),ac:e.o(z),ad:e.o(()=>{m.value="",g.value=!1}),ae:e.p({useSlot:!0,title:"添加标签",show:g.value,showCancelButton:!0})})}}),ee=e._export_sfc(Z,[["__scopeId","data-v-0865f6d7"],["__file","J:/fItness/wx-fitness/apps/fitness/src/subpackages/studentDetail/index.vue"]]);wx.createPage(ee);
