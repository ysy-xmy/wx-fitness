"use strict";const e=require("../../common/vendor.js"),d=require("../apis/api.js"),_=require("../../state/modules/auth.js"),y=require("../../api/user/index.js");require("../../utils/request.js");require("../../state/modules/mes.js");require("../../api/notify/index.js");const B=e.defineComponent({__name:"index",setup(F){const T=_.useAuthStore(),n=e.computed(()=>T.user);e.onMounted(async()=>{e.index.showLoading();const a=await y.getUserInfo();h.value=a.data.data.Username,r.value=Number(a.data.data.Age)-14||0,f.value=a.data.data.Avatar||"https://zhanjiang-fitness.oss-cn-guangzhou.aliyuncs.com/20250105/1736063470137.png",i.value=a.data.data.Sex||0,g.value=a.data.data.ID,c.value=a.data.data.WeChatBusinessImg?[a.data.data.WeChatBusinessImg]:[],u.value=a.data.data.CoachCert?[a.data.data.CoachCert]:[],l.value=a.data.data.BodyCheckTable||[],e.index.hideLoading()});const p=(a,o)=>{e.index.previewImage({current:a,urls:o,loop:!0,indicator:"number"})},h=e.ref("微信用户"),u=e.ref([]),r=e.ref(0),f=e.ref("https://zhanjiang-fitness.oss-cn-guangzhou.aliyuncs.com/20250105/1736063470137.png"),i=e.ref(0),g=e.ref(""),x=e.ref(["男","女"]),l=e.ref([]),m=e.ref(Array.from({length:87},(a,o)=>o+14)),c=e.ref([]),C=()=>{e.index.chooseImage({count:9,sizeType:["original","compressed"],sourceType:["album"],success:a=>{w(a.tempFilePaths)},fail:a=>{console.error("选择图片失败:",a)}})},w=async a=>{try{const o=a.map(t=>d.uploadimg(t)),s=await Promise.all(o);console.log(s,"上传结果"),s.forEach(t=>{console.log(l.value,"当前 imgList"),l.value.push(t)})}catch(o){console.error("上传图片时出错:",o)}},U=()=>{e.index.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album"],success:a=>{console.log(a.tempFilePaths),a.tempFilePaths.forEach(o=>{console.log(o),d.uploadimg(o).then(s=>{u.value=[s]})})}})},b=a=>{h.value=a.detail.value},S=a=>{r.value=a.detail.value},D=a=>{i.value=parseInt(a.detail.value)},P=a=>{e.index.showModal({title:"删除",content:"确定要删除这张照片？",cancelText:"再看看",confirmText:"删除",success:o=>{o.confirm&&l.value.splice(a.currentTarget.dataset.index,1)}})},q=a=>{e.index.showModal({title:"删除",content:"确定要删除这张照片？",cancelText:"再看看",confirmText:"删除",success:o=>{o.confirm&&(c.value=[])}})},z=a=>{e.index.showModal({title:"删除",content:"确定要删除这张照片？",cancelText:"再看看",confirmText:"删除",success:o=>{o.confirm&&(u.value=[])}})},v=e.ref({ID:g.value,Avatar:f,Username:n.value.name,Sex:n.value.Sex,Age:n.value.Age});console.log("userInfo",v.value);const L=a=>{d.uploadimg(a.detail.avatarUrl).then(o=>{v.value={ID:n.value.ID,Avatar:o,Username:n.value.name,Sex:n.value.Sex,Age:n.value.Age}})},N=async a=>{e.index.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album"],success:o=>{console.log(o.tempFilePaths),o.tempFilePaths.forEach(s=>{console.log(s),d.uploadimg(s).then(t=>{c.value.push(t)})})}})},k=()=>{const a=_.useAuthStore(),o=a.getUser;let s={};o.RoleName==="coach"?s={ID:g.value,Username:h.value,Sex:i.value,Age:m.value[r.value],Avatar:v.value.Avatar,BodyCheckTable:l.value,CoachCert:u.value[0]||"",WeChatBusinessImg:c.value[0]||""}:s={ID:g.value,Username:h.value,Sex:i.value,Age:m.value[r.value],Avatar:v.value.Avatar,BodyCheckTable:l.value},e.index.showLoading({title:"修改中",mask:!0}),y.updateUserInfo(s).then(()=>{e.index.hideLoading(),e.index.showToast({title:"保存成功",icon:"success"}),a.setUser({name:h.value,id:g.value,phone:o.phone,Sex:i.value,img:v.value.Avatar,RoleName:o.RoleName,Age:m.value[r.value]}),e.index.$emit("changeUser",!0)}).catch(()=>{e.index.hideLoading(),e.index.showToast({title:"保存失败",icon:"error"})})};return(a,o)=>e.e({a:v.value.Avatar},v.value.Avatar?{b:v.value.Avatar}:{},{c:e.o(L),d:h.value,e:e.o(b),f:e.t(i.value>-1?x.value[i.value]:"请选择性别"),g:e.o(D),h:i.value,i:x.value,j:e.t(r.value>-1?m.value[r.value]:"请选择年龄"),k:e.o(S),l:r.value,m:m.value,n:e.unref(n).RoleName==="coach"},e.unref(n).RoleName==="coach"?e.e({o:e.f(c.value,(s,t,A)=>({a:c.value[t],b:e.o(I=>p(t,c.value),t),c:e.o(q,t),d:t,e:t,f:c.value[t]})),p:c.value.length<1},c.value.length<1?{q:e.o(N)}:{}):{},{r:e.unref(n).RoleName==="coach"},e.unref(n).RoleName==="coach"?e.e({s:e.f(u.value,(s,t,A)=>({a:u.value[t],b:e.o(I=>p(t,u.value),t),c:e.o(z,t),d:t,e:t,f:u.value[t]})),t:u.value.length<1},u.value.length<1?{v:e.o(U)}:{}):{},{w:e.f(l.value,(s,t,A)=>({a:l.value[t],b:e.o(I=>p(t,l.value),t),c:e.o(P,t),d:t,e:t,f:l.value[t]})),x:l.value.length<9},l.value.length<9?{y:e.o(C)}:{},{z:e.o(k)})}}),R=e._export_sfc(B,[["__file","J:/fItness/wx-fitness/apps/fitness/src/subpackages/exitinfo/index.vue"]]);wx.createPage(R);
