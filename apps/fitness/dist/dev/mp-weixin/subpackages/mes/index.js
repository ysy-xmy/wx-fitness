"use strict";const e=require("../../common/vendor.js"),f=require("../../api/notify/index.js"),y=require("../../state/modules/mes.js"),g=require("../../state/modules/auth.js");require("../../utils/request.js");if(!Array){const c=e.resolveComponent("van-icon"),t=e.resolveComponent("van-collapse-item"),s=e.resolveComponent("van-loading"),i=e.resolveComponent("van-collapse");(c+t+s+i)()}const S=e.defineComponent({__name:"index",setup(c){const t=y.usemesStore(),s=e.reactive({mesType:"total",checked:!1,searchVal:"",activeKey:[],page_size:10,page_index:1,loading:!0});e.onMounted(()=>{var o,n;p(),i.value=(o=u.value)!=null&&o.offsetHeight?(n=u.value)==null?void 0:n.offsetHeight:0});const i=e.ref(0),_=async()=>{t.hadNew===0?e.index.showToast({title:"没有新消息",icon:"none"}):(await f.readNotify(-1)).data.code==200?(t.setClear(!0),t.sethadNew(0),v.value.forEach(n=>{n.Status=!0}),e.index.showToast({title:"全部已读成功",icon:"success"})):e.index.showToast({title:"全部已读失败",icon:"error"})},m=o=>{o&&(console.log(o.detail),console.log(t.mesList),s.activeKey=o.detail,e.nextTick$1(()=>{const n=o.detail;console.log(typeof n,1234565),typeof n=="number"&&(t.mesList[n].Status||f.readNotify(t.mesList[n].ID).then(a=>{console.log(a),a.data.code==200&&(console.log(t.mesList[n]),t.mesList[n].Status=!0,t.sethadNew(!1))}))}))},p=async()=>{s.activeKey=[],s.page_size=10,s.page_index=1,h.value=[];let o={userId:g.useAuthStore().user.id,page:s.page_index,size:s.page_size};d(o)},u=e.ref(null),h=e.ref([]);e.ref("");const v=e.ref([]),d=o=>{s.loading=!0,t.addMesList(o).then(()=>{s.loading=!1}).catch(n=>{console.log(n),e.index.showToast({title:"获取消息失败",icon:"error"})})},L=o=>{const{scrollTop:n,scrollHeight:a}=o.detail;e.index.createSelectorQuery().select(".bg").boundingClientRect(l=>{if(!l)return;const r=l.height;if(n+r>=a-20){if(s.loading||t.mesList.length>=t.total)return;s.loading=!0,s.page_index++;const x={userId:g.useAuthStore().user.id,page:s.page_index,size:s.page_size};d(x).finally(()=>{s.loading=!1})}}).exec()};return(o,n)=>e.e({a:e.p({name:"success"}),b:e.o(_),c:e.unref(t).mesList.length>0},e.unref(t).mesList.length>0?e.e({d:e.f(e.unref(t).mesList,(a,l,r)=>e.e({a:!a.Status},a.Status?{}:{},{b:e.t(a.Title),c:a.Content,d:"d6ae87f9-2-"+r+",d6ae87f9-1",e:e.p({name:a.id}),f:a.ID})),e:e.unref(t).mesList.length>=e.unref(t).total-1},e.unref(t).mesList.length>=e.unref(t).total-1?{}:e.unref(t).mesList.length<e.unref(t).total-1&&s.loading?{}:{},{f:e.unref(t).mesList.length<e.unref(t).total-1&&s.loading,g:e.o(m),h:e.p({value:s.activeKey,accordion:!0})}):{},{i:e.unref(t).mesList.length===0},e.unref(t).mesList.length===0?{}:{},{j:e.o(L),k:i.value})}}),w=e._export_sfc(S,[["__scopeId","data-v-d6ae87f9"],["__file","J:/fItness/wx-fitness/apps/fitness/src/subpackages/mes/index.vue"]]);wx.createPage(w);
