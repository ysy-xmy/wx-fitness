"use strict";const e=require("../../common/vendor.js"),k=require("../../api/action/action.js"),H=require("../../state/modules/auth.js"),J=require("../../state/modules/actions.js");require("../../utils/request.js");require("../../state/modules/mes.js");require("../../api/notify/index.js");if(!Array){const b=e.resolveComponent("cu-custom"),y=e.resolveComponent("van-icon"),f=e.resolveComponent("van-checkbox"),m=e.resolveComponent("transition"),I=e.resolveComponent("van-empty"),x=e.resolveComponent("van-divider"),A=e.resolveComponent("van-index-bar"),N=e.resolveComponent("van-button"),w=e.resolveComponent("van-popup");(b+y+f+m+I+x+A+N+w)()}const K=e.defineComponent({__name:"index",setup(b){const y=J.useActionsStore(),f=e.ref(y.getChooseActions),m=e.ref(!1);H.useAuthStore();const I=(r,o)=>{o.map(t=>{t.active=!1}),r.active=!r.active},x=()=>{if(d.value.length==0)e.index.showToast({title:"当前没有动作",icon:"error"});else{const o=y.getChooseActionId;let t=[];d.value.forEach(n=>{let a={PlanID:o,ActionGroupTitle:f.value.name,ExerciseActionID:n.id,ActionName:n.name};f.value.type=="stretch"?a.ContentType="stretch":a.ContentType="weight",a.OrderNum=0,a.PlanActionDetail=[],t.push(a)}),console.log(t,"classes"),k.addActionToGroupAction(t).then(n=>{n.data.code==200?(e.index.showToast({title:"添加成功",icon:"success"}),e.index.$emit("reload"),setTimeout(()=>{w.back()},1e3)):e.index.showToast({title:"添加失败",icon:"error"})}).catch(n=>{e.index.showToast({title:"添加失败",icon:"error"})})}},A=(r,o)=>{const t="https://zhanjiang-fitness.oss-cn-guangzhou.aliyuncs.com/20241007/1728284282969.png";return r&&r[o]?r[o].URL:t},N=()=>{m.value=!1},w=e.H(),D=e.ref([{name:"A",id:0,OrderNum:1,children:[]}]),T=e.ref(),v=e.ref(""),g=e.ref([]);D.value=_(D.value);const l=e.ref([]),C=e.ref([]),p=e.ref(0),s=e.ref(0),S=e.ref(0);function $(r,o){let t=!1;return function(){const n=arguments,a=this;t||(r.apply(a,n),t=!0,setTimeout(()=>t=!1,o))}}function q(r){const o=[];return r.forEach(t=>{const n=t.FirstCategory,a={name:n.Name,id:n.ID,OrderNum:n.OrderNum,children:[]};t.SecondCategoryInfos&&t.SecondCategoryInfos.forEach(c=>{const i=c.SecondCategory,h={name:i.Name,id:i.ID,OrderNum:i.OrderNum,children:[]};c.ActionInfos&&c.ActionInfos.forEach(u=>{const G={CreatedAt:u.ActionInfos.CreatedAt,Description:u.ActionInfos.Description,id:u.ActionInfos.ID,name:u.ActionInfos.Name,OrderNum:u.ActionInfos.OrderNum,SecondCategoryID:u.ActionInfos.SecondCategoryID};h.children.push(G)}),a.children.push(h)}),o.push(a)}),o}function z(r,o){for(let t=0;t<r.length;t++){const n=r[t];if(n.children&&n.children.length>0)for(let a=0;a<n.children.length;a++){const c=n.children[a];if(c.children&&c.children.length>0){for(let i=0;i<c.children.length;i++)if(c.children[i].id===o)return{firstCategoryId:n.id,secondCategoryId:c.id}}}}return{firstCategoryId:null,secondCategoryId:null}}function _(r){const o=(n,a)=>n.OrderNum!==a.OrderNum?a.OrderNum-n.OrderNum:a.id-n.id,t=n=>n?n.map(a=>({...a,ifcheck:!!d.value.find(c=>c.id==a.id),children:t(a.children)})).sort(o):[];return r.map(n=>({...n,children:t(n.children)})).sort(o)}const P=r=>{f.ifChoose||w.push({name:"actionDetail",params:{itemid:String(r.id)}})},B=r=>{const{firstCategoryId:o,secondCategoryId:t}=z(l.value,r),n=l.value.findIndex(c=>c.id===o),a=l.value[n].children.findIndex(c=>c.id===t);if(n!==-1&&a!==-1){p.value=n,s.value=n,S.value=(n-1)*50,l.value[n].children.forEach(i=>i.active=!1);const c=l.value[n].children[a];c.active=!0,O(l.value[n]),e.nextTick$1(()=>{const i=`#main-${a}`,h=e.index.createSelectorQuery().in(this);h.select(i).boundingClientRect(),h.exec(u=>{u[0]&&e.index.pageScrollTo({scrollTop:u[0].top,duration:300})})}),e.nextTick$1(()=>{const i=c.children.findIndex(h=>h.id===r);i!==-1&&I(c.children[i],c.children)})}v.value="",E(l.value,v.value)},j=(r,o)=>{l.value[s.value].children[o].active=!l.value[s.value].children[o].active,!l.value[s.value].children[o].children[0].Imgs&&k.getActionsBySec(String(r.id)).then(t=>{l.value[s.value].children[o].children=t.data.data.map(n=>({id:n.ID,name:n.Name,OrderNum:n.OrderNum,children:[],Imgs:n.Imgs,Videos:n.Videos,Description:n.Description,CreatedAt:n.CreatedAt})),l.value=_(l.value)})},E=(r,o)=>{if(!o)return g.value=[],[];const t=[],n=(a,c=!0)=>{c?a.children&&a.children.length>0&&a.children.forEach(i=>n(i,!1)):(typeof a.name=="string"&&a.name.toLowerCase().includes(o.toLowerCase())&&t.push(a),a.children&&a.children.length>0&&a.children.forEach(i=>n(i,!1)))};return r.forEach(a=>n(a)),T.value=t.map(a=>a.name),g.value=t,t};e.watch(v,$(function(r){E(l.value,r)},200)),e.reactive({stuId:-1,courseId:-1,type:""}),e.onMounted(async()=>{try{e.index.showLoading({title:"加载中...",mask:!0});const r=await k.getActionAll(),o=q(r.data.data);if(l.value=_(o),l.value.length>0){p.value=0,s.value=0,S.value=0;const t=l.value[0];await L(t)}e.index.hideLoading()}catch(r){e.index.hideLoading(),e.index.showToast({title:"加载失败",icon:"error"}),console.error("初始化数据失败:",r)}});const d=e.ref([]),M=(r,o,t,n)=>{const a=l.value[t].children[n].children.find(c=>c==o);a&&(a.ifcheck?d.value=d.value.filter(c=>c.id!=o.id):d.value.push({...o,num:0,second:0,weight:0}),l.value[t].children[n].children.find(c=>c==o).ifcheck=!a.ifcheck)},L=async r=>{const o=r.id;if(r.children.length>0){O(r);return}try{e.index.showLoading({title:"加载中...",mask:!0});const t=await k.getSecByFirst(o);t.data.data.length>0&&(l.value.find(n=>n.id===o).children=t.data.data.map(n=>({id:n.ID,name:n.Name,OrderNum:n.OrderNum,children:[],active:!1}))),O(r),l.value=_(l.value)}finally{e.index.hideLoading()}},O=r=>{let o=[];r.children&&(r.children.length>0?(r.children.forEach(t=>{let n={name:t.name,id:t.id,OrderNum:t.OrderNum,children:[]};o.push(n)}),C.value=_(o)):(o=[],C.value=o))},R=async r=>{const o=r.currentTarget.dataset.id;p.value=o,s.value=o,S.value=(o-1)*50,L(l.value[o])},V=r=>{},F=r=>{const o=d.value.indexOf(r);o>-1&&(d.value.splice(o,1),l.value.forEach(t=>{t.children.forEach(n=>{if(n.children){const a=n.children.find(c=>c.id===r.id);a&&(a.ifcheck=!1)}})}))},U=()=>{v.value="",g.value=[]};return(r,o)=>e.e({a:v.value,b:e.o(t=>v.value=t.detail.value),c:v.value},v.value?{d:e.o(U)}:{},{e:e.t(f.value.name||""),f:e.t(d.value.length),g:e.o(t=>m.value=!0),h:e.p({isBack:!1,bgColor:"bg-shadeTop text-white"}),i:e.f(l.value,(t,n,a)=>({a:e.t(t.name),b:n==p.value?"#5adade":"#f7f8fc",c:n==p.value?"#ffffff":"",d:n==p.value?"bold":"",e:n==p.value?"5px":"",f:n,g:e.o(R,n),h:n})),j:S.value,k:C.value.length>0},C.value.length>0?{l:e.f(C.value,(t,n,a)=>e.e({a:e.t(t.name),b:l.value[s.value].children[n].active,c:"26445da3-1-"+a,d:!l.value[s.value].children[n].active,e:"26445da3-2-"+a,f:e.o(c=>j(t,n),n),g:l.value[s.value].children[n].active},l.value[s.value].children[n].active?{h:e.f(l.value[s.value].children[n].children,(c,i,h)=>e.e({a:e.t(c.name),b:e.o(u=>I(c,l.value[s.value].children[n].children),i),c:e.o(u=>M(u,c,s.value,n),i),d:"26445da3-3-"+a+"-"+h,e:e.p({value:c.ifcheck,checkedColor:"#f60422"}),f:c.active},c.active?{g:A(c.Imgs,0),h:A(c.Imgs,1),i:e.o(u=>P(c),i)}:{},{j:"26445da3-4-"+a+"-"+h,k:i})),i:e.p({name:"fade"})}:{},{j:n,k:"main-"+n})),m:e.p({name:"arrow-down"}),n:e.p({name:"arrow-up"})}:{o:e.p({description:"没有数据"})},{p:"main-"+s.value,q:e.o(V),r:g.value.length>0},g.value.length>0?{s:e.f(g.value,(t,n,a)=>e.e({a:e.t(t.name),b:t.children&&t.children.length>0},t.children&&t.children.length>0?{c:e.f(t.children,(c,i,h)=>({a:e.t(c.name)}))}:{},{d:e.o(c=>B(t.children.length>0?t.children[0].id:t.id),n),e:n})),t:e.p({["index-list"]:T.value})}:{},{v:e.o(N),w:e.p({name:"close",size:"30px"}),x:e.t(f.value.type==="stretch"?"放松训练":"力量训练"),y:d.value.length==0},d.value.length==0?{z:e.p({description:"暂未选择动作"})}:{},{A:e.f(d.value,(t,n,a)=>({a:e.t(t.name),b:e.o(c=>F(t)),c:"26445da3-11-"+a+",26445da3-8"})),B:e.p({name:"minus",size:"20px",color:"#ee0a24"}),C:e.o(x),D:e.p({type:"info",size:"normal",round:!0}),E:e.o(N),F:e.p({customStyle:"max-height: 500px;",show:m.value,position:"bottom",overlay:"false"})})}}),Q=e._export_sfc(K,[["__file","J:/fItness/wx-fitness/apps/fitness/src/subpackages/actionArrange/index.vue"]]);wx.createPage(Q);
