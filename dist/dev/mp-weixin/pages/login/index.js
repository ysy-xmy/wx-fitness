"use strict";const e=require("../../common/vendor.js"),p=require("../../state/modules/auth.js"),x=require("./wx_session.js");require("../../utils/request.js");const f=e.defineComponent({__name:"index",setup(m){const u=e.H(),r=p.useAuthStore();e.reactive({name:"小团体",passWord:"123456"});function d(){e.index.login({provider:"weixin",onlyAuthorize:!0,success:function(a){const{code:c}=a;console.log("code",c),e.index.request({url:`http://43.139.169.144:8081/api/user/wx-login?code=${c}`,method:"POST",success:t=>{let l=t.data.data.OpenID;if(console.log("登录返回信息",t.data),t.data.code===200){const o=t.data.data.Token;e.index.setStorageSync("token",o),r.token=o,u.push("/pages/home/index")}new Promise((o,s)=>{e.index.getUserInfo({success:n=>{console.log("suceess",n),o(n)},fail:n=>{console.error("获取用户信息失败：",n),s(n)}})}).then(o=>{console.log(o);const{nickName:s,avatarUrl:n,gender:i}=o.userInfo,_={OpenID:l,Username:s,Avatar:n,Sex:i};x.updateUserInfo(_).then(()=>{console.log("更新用户信息成功"),r.user={nickName:s,avatarUrl:n,gender:i}}).catch(g=>{console.error("更新用户信息失败：",g)})}).catch(o=>{console.error("获取用户信息失败：",o)})},fail:t=>{console.error("登录失败：",t),e.index.showToast({title:"登录失败",icon:"none"})}})}})}return(a,c)=>({a:e.o(d)})}}),h=e._export_sfc(f,[["__scopeId","data-v-45258083"],["__file","D:/data/project/fitness/prod/wx-fitness/src/pages/login/index.vue"]]);wx.createPage(h);
