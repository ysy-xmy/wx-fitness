"use strict";const e=require("../../common/vendor.js"),o=require("../../state/modules/auth.js"),s=require("./wx_session.js");require("../../utils/request.js");const n=e.defineComponent({__name:"index",setup(n){const t=e.H(),r=o.useAuthStore();function c(){e.index.login({provider:"weixin",onlyAuthorize:!0,success:function(o){const{code:n}=o;console.log("code",n),e.index.request({url:`http://43.139.169.144:8081/api/user/wx-login?code=${n}`,method:"POST",success:o=>{let n=o.data.data.OpenID;if(console.log("登录返回信息",o.data),200===o.data.code){const s=o.data.data.Token;e.index.setStorageSync("token",s),r.token=s,t.push("/pages/home/index")}new Promise(((o,s)=>{e.index.getUserInfo({success:e=>{console.log("suceess",e),o(e)},fail:e=>{console.error("获取用户信息失败：",e),s(e)}})})).then((e=>{console.log(e);const{nickName:o,avatarUrl:t,gender:c}=e.userInfo,a={OpenID:n,Username:o,Avatar:t,Sex:c};s.updateUserInfo(a).then((()=>{console.log("更新用户信息成功"),r.user={nickName:o,avatarUrl:t,gender:c}})).catch((e=>{console.error("更新用户信息失败：",e)}))})).catch((e=>{console.error("获取用户信息失败：",e)}))},fail:o=>{console.error("登录失败：",o),e.index.showToast({title:"登录失败",icon:"none"})}})}})}return e.reactive({name:"小团体",passWord:"123456"}),(o,s)=>({a:e.o(c)})}}),t=e._export_sfc(n,[["__scopeId","data-v-45258083"],["__file","D:/code/vscode project/fitness-wxclient/src/pages/login/index.vue"]]);wx.createPage(t);
