"use strict";const t=require("../../../../../common/vendor.js"),e=require("./wx-canvas.js");let s;function i(t){for(let e=0;e<t.touches.length;++e){const s=t.touches[e];s.offsetX=s.x,s.offsetY=s.y}return t}require("./echarts.js");const a={props:{canvasId:{type:String,default:()=>"ec-canvas"},ec:{type:Object},forceUseOldCanvas:{type:Boolean,value:!1}},data:()=>({$curChart:{},toHandleList:[],isUseNewCanvas:!0}),watch:{"ec.option":{deep:!0,handler(t,e){this.setOption(t)}}},onReady:function(){this.ec?this.ec.lazyLoad||this.init():console.warn('组件需绑定 ec 变量，例：<ec-canvas id="mychart-dom-bar" canvas-id="mychart-bar" ec="{{ ec }}"></ec-canvas>')},methods:{compareVersion(t,e){t=t.split("."),e=e.split(".");const s=Math.max(t.length,e.length);for(;t.length<s;)t.push("0");for(;e.length<s;)e.push("0");for(let i=0;i<s;i++){const s=parseInt(t[i]),a=parseInt(e[i]);if(s>a)return 1;if(s<a)return-1}return 0},init(e){const s=t.wx$1.getSystemInfoSync().SDKVersion;let i=this.compareVersion(s,"2.9.0")>=0;if(this.forceUseOldCanvas&&(i&&console.warn("开发者强制使用旧canvas,建议关闭"),i=!1),this.isUseNewCanvas=i&&!this.forceUseOldCanvas,this.isUseNewCanvas)console.log('微信基础库版本大于2.9.0，开始使用<canvas type="2d"/>'),this.initByNewWay(e);else{if(!(this.compareVersion(s,"1.9.91")>=0))return void console.error("微信基础库版本过低，需大于等于 1.9.91。参见：https://github.com/ecomfe/echarts-for-weixin#%E5%BE%AE%E4%BF%A1%E7%89%88%E6%9C%AC%E8%A6%81%E6%B1%82");console.warn("建议将微信基础库调整大于等于2.9.0版本。升级后绘图将有更好性能"),this.initByOldWay(e)}},initByOldWay(i){s=t.wx$1.createCanvasContext(this.canvasId,this);const a=new e.WxCanvas(s,this.canvasId,!1),n=this;(void 0)((()=>a));t.wx$1.createSelectorQuery().in(this).select(".ec-canvas").boundingClientRect((t=>{"function"==typeof i?n.$curChart=i(a,t.width,t.height,1):n.ec?n.$curChart=n.initChart(a,t.width,t.height,1):n.triggerEvent("init",{canvas:a,width:t.width,height:t.height,devicePixelRatio:1})})).exec()},initByNewWay(s){const i=this;t.wx$1.createSelectorQuery().in(this).select(".ec-canvas").fields({node:!0,size:!0}).exec((a=>{const n=a[0].node,c=t.wx$1.getSystemInfoSync().pixelRatio,o=a[0].width,r=a[0].height,h=n.getContext("2d"),u=new e.WxCanvas(h,i.canvasId,!0,n);(void 0)((()=>u)),"function"==typeof s?i.$curChart=s(u,o,r,c):i.ec?i.$curChart=i.initChart(u,o,r,c):i.triggerEvent("init",{canvas:u,width:o,height:r,devicePixelRatio:c})}))},setOption(t){this.$curChart&&this.$curChart.setOption?this.$curChart.setOption(t):this.toHandleList.push(t)},canvasToTempFilePath(e){if(this.isUseNewCanvas){t.wx$1.createSelectorQuery().in(this).select(".ec-canvas").fields({node:!0,size:!0}).exec((s=>{const i=s[0].node;e.canvas=i,t.wx$1.canvasToTempFilePath(e)}))}else e.canvasId||(e.canvasId=this.canvasId),s.draw(!0,(()=>{t.wx$1.canvasToTempFilePath(e,this)}))},touchStart(t){if(this.ec.stopTouchEvent)return t.preventDefault(),void t.stopPropagation();if(this.$emit("touchstart",t),this.$curChart&&t.touches.length>0){var e=t.touches[0],s=this.$curChart.getZr().handler;s&&(s.dispatch("mousedown",{zrX:e.x,zrY:e.y}),s.dispatch("mousemove",{zrX:e.x,zrY:e.y}),s.processGesture(i(t),"start"))}},touchMove(t){if(this.ec.stopTouchEvent)return t.preventDefault(),void t.stopPropagation();if(this.$emit("touchmove",t),this.$curChart&&t.touches.length>0){var e=t.touches[0],s=this.$curChart.getZr().handler;s&&(s.dispatch("mousemove",{zrX:e.x,zrY:e.y}),s.processGesture(i(t),"change"))}},touchEnd(t){if(this.ec.stopTouchEvent)return t.preventDefault(),void t.stopPropagation();if(this.$emit("touchend",t),this.$curChart){const s=t.changedTouches?t.changedTouches[0]:{};var e=this.$curChart.getZr().handler;e&&(e.dispatch("mouseup",{zrX:s.x,zrY:s.y}),e.dispatch("click",{zrX:s.x,zrY:s.y}),e.processGesture(i(t),"end"))}},initChart(t,e,s,i){return this.$curChart=(void 0)(t,null,{width:e,height:s,devicePixelRatio:i}),t.setChart(this.$curChart),this.$curChart.setOption(this.ec.option),this.$emit("inited",this.$curChart),this.$curChart}}};const n=t._export_sfc(a,[["render",function(e,s,i,a,n,c){return t.e({a:n.isUseNewCanvas},n.isUseNewCanvas?{b:i.canvasId,c:t.o(((...t)=>c.init&&c.init(...t))),d:t.o(((...t)=>c.touchStart&&c.touchStart(...t))),e:t.o(((...t)=>c.touchMove&&c.touchMove(...t))),f:t.o(((...t)=>c.touchEnd&&c.touchEnd(...t)))}:{g:i.canvasId,h:t.o(((...t)=>c.init&&c.init(...t))),i:t.o(((...t)=>c.touchStart&&c.touchStart(...t))),j:t.o(((...t)=>c.touchMove&&c.touchMove(...t))),k:t.o(((...t)=>c.touchEnd&&c.touchEnd(...t)))})}],["__file","D:/code/vscode project/fitness-wxclient/src/uni_modules/js_sdk/ec-canvas/echarts-for-wx-uniapp-1.0.2/uni-ec-canvas/uni-ec-canvas.vue"]]);wx.createComponent(n);
